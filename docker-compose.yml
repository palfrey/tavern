version: '3'
services:
  postgres:
    image: postgres:10
    environment:
      - POSTGRES_PASSWORD=mysecretpassword
    ports:
     - 5432:5432
  backend:
    build: backend
    command: wait-for-it postgres:5432 -s -t 0 -- cargo watch -s "cargo fmt && cargo run"
    environment:
      - DATABASE_URL=postgresql://postgres:mysecretpassword@postgres:5432/postgres
      - FRONTEND=/frontend/public
    volumes:
     - ./backend:/work:cached
     - ./frontend:/frontend:cached
    links:
     - postgres
    ports:
     - 5000:5000
    restart: always
  frontend:
    build: frontend
    volumes:
     - ./frontend:/work:cached
    restart: always